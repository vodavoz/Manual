---
order: 597
icon: pin
date: 2023-05-19 
---

# Настройка публикации 
Перед началом работы с приложением необходимо опубликовать базу 1с. Это обязательное условие работы. Настройку публикации мы рассмотрим на примере службы IIS. 
Мы пройдем следующие этапы:
1. Установка службы ИИС
2. Настройка службы для работы с 1с
3. Публикация базы данных
4. Настройка авторизации для мобильных приложений
5. Проверка работосособности. 
 
### Установка службы ИИС

Установка службы происходит через панель управления - включение и отключение компонентов windows

![включение и отключение компонентов windows](/images/Установка_ИИС_1.png)

Далее находим службу IIS и указываем необходимые параметры установки по образцу на скриншоте

![Пример заполнения](/images/Установка_ИИС_2.png)

### Настройка службы

Для корректной работы системы необходимо настроить пулы приложений. Для этого откроем IIS через меню пуск.

![Запуск приложения](/images/Настройка_ИИС_1.png)

Далее развернем раздел с подключениеями, в нем выберем пулы приложения. Здесь нас интересует пункт DefaultAppPools, нажимает на него правой клавишей мыши и выбираем пунк "Дополнительные параметры"

![Выбор настроек](/images/Настройка_ИИС_2.png)

Далее нас интересуют 2 признака. "Разрешены 32х разрядные приложения"- ставим True, если у вас 32х битная 1с и false в противном случае. "Режим управляемого конвейера" - classic

![Настройка пулов приложений](/images/Настройка_ИИС_3.png)

На это настройка IIS заканчивается, далее проверяем работоспособность.

### Публикация информационной базы

Для публикации информационной базы необходимо, что 1с была установлена с включенной компонентой публикации веб сервисов, она выделена на скриншоте ниже

![Проверка установки](/images/Публикация_1с_1.png)

Далее необходимо запустить 1с [!badge variant="warning" text="от имени администратора"] и открыть конфигуратор. В нем переходим в раздел администрирование и нажимаем [!badge variant="Primary" text="публикация информационной базы"] 

![Проверка установки](/images/Публикация_1с_2.png)

Перед наими откроется окно с настройками публикации. Мы будем делать две публикации. Одна для работы http и веб сервисов, вторая для работы пользователей.

+++ Публикация для работы сервисов
Для публикации имя указываем латиницей, рекомендуем называть базу [!badge variant="Primary" text="vodavoz_mobile"], так будет сразу понятно, что вы публикуете. 
В настройках публикации отключаем публикацию клиентской части, odata интерфейс и аналитику, в текущих настройках они нам не нужны. 

![Пример заполнения](/images/Публикация_1с_3.png) ![Пример заполнения](/images/Публикация_1с_4.png) 


+++ Публикация для работы пользователей
Имя указываем латиницей, рекомендуем называть базу [!badge variant="Primary" text="vodavoz_web"], так будет сразу понятно, что вы публикуете. 
В настройках публикации отключаем публикацию web и http сервисов. Так же желательно указать путь к дистрибутиву публикации, что бы можно было работать через тонкий клиент 1с, а не браузер. Это облегчит работу по настройке рабочих мест. Подробнее можно почитать на сайте [!ref  text="ИТС"](https://its.1c.ru/db/v8322doc#bookmark:adm:TI000001058)

![Пример заполнения](/images/Публикация_1с_5.png) ![Пример заполнения](/images/Публикация_1с_6.png) 
+++

После завершения публикации мы можем приступить к следующему шагу. 

### Настройка авторизации мобильного приложения

Для работоспособности мобильного приложения необходимо создать пользователя в 1с в дальнейшем сервисы будут работать под его учетной записью. 

Перейдем в раздел администрирования - настройки пользователей и прав - пользователи. Здесь создадим пользователя, назовем его [!badge variant="Primary" text="Web_APP"]. 
На необходимо запретить изменение и восстановление пароля у пользователя. Так же запретить аутентификацию по Open ID и операционной системе. Далее задаем пароль, можем воспользоваться функцие автогенерации, главное запишите его, он нам ещё пригодиться. 

![Создание пользователя](/images/Настройка_Авторизации_1.png)

Далее зададим пользователю права. Т.к. мы делаем общую настройку для множества внутренних сервисов, а не только приложения экспедитора, то выдадим полный доступ пользователю. 

![Создание пользователя](/images/Настройка_Авторизации_2.png)

После того, как мы завели пользователя в систему, нам необходимо отредактировать файл default.vrd, как правило он находится по следующему пути C\inetpub\wwwroot\vodavoz_mobile
Нам необходимо открыть данный файл, сделать это можно при помощи блокнота или же специализированных приложений, к примеру [!ref notpad++"](https://notepad-plus-plus.org/downloads/). 

![Внешний вид файла](/images/Настройка_Авторизации_3.png)

Далее нам необходимо внести изменения в строку "ib="Srvr=&quot;SRV1C&quot;;Ref=&quot;VodaVoz2017&quot;;" приведя её к виду "ib="Srvr=&quot;SRV1C&quot;;Ref=&quot;VodaVoz2017&quot;;Usr=&quot;Web_App&quot;;Pwd=&quot;BY2ji0hi&quot;;" Где Web_App - имя созданного нами пользователя, а BY2ji0hi - его пароль. Далее сохраняем файл и можем проверять работу приложения

### Проверка работоспособности

Для начала узнаем наш внешний айпи адрес, и уточняем у провайдера является ли он статически (белым). Проще всего узнать это через сайт [!ref icon="rocket" text="2ip.ru"](https://2ip.ru/)

![Получение ip адреса](/images/Проверка_работоспособности_1.png)
Здесь мы можем увидеть наш айпи адрес. Он в дальнейшем потребуется для настройки, его необходимо сообщить разработчикам после публикации. 
После того, как мы узнали айпи адрес, нам необходимо настроить проброс портов с нашего роутера, до сервера на котором находится 1с. К примеру переадресация с порта 8888 на порт 80. Тут вам на помощь должен прийти системный администратор, т.к. техники различной много и все мы их в инструкции не опишем. 

После того, как порт проброшен мы можем проверить работоспособность базы. Для этого необходимо перейти по следующему сетевому адресу
"92.241.102.242:8888/vodavoz_mobile/hs/vodavoz/*" где 92.241.102.242 наш внешний айпи, 8888 это порт который мы устанавливали, а vodavoz_mobile- имя нашей публикации. 

Если всё хорошо, то вы увидите сообщение. "Сервис работает по адресу: Srvr="ssql";Ref="vodavoz_mobile";"
